{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"subpatch: fearless multi-repository management - stay relaxed!","text":"<p>Welcome to the website of subpatch. The tool that does multi-repository management right. Don't worry, stay relaxed!</p> <p>Currently this project is just an idea. No code yet. But the general concept is already proven and works!</p> <p>The subpatch project will provide two things:</p> <ul> <li>A command line tool called <code>subpatch</code> to manage subprojects in a source control repository,   e.g. in a git repository. The github repository is   subpatch.</li> <li>Documentation, explanations and opinions about multi repo setups and   management. This is this website.</li> </ul> <p>If you are currently using git-submodules or repo and you are frustrated, <code>subpatch</code>  will be mostly your solution! If you are interested, email me.</p>"},{"location":"#subpatch-usecases","title":"subpatch usecases","text":"<p>subpatch is interesting for you if you want to do the following tasks:</p> <ul> <li>assemble a monorepo from multiple repositories</li> <li>integrate third party dependencies into your project as source files</li> <li>maintain a local fork (=linear patchstack) of a third party dependency</li> </ul>"},{"location":"#subpatchs-concept","title":"subpatch's concept","text":"<p>subpatch will be a subprojects management tool based on the following ideas:</p> <ul> <li>It's based on the idea of <code>git add</code> and <code>git read-tree</code>. The files of   subprojects are added as normal files to the superproject.  In most cases   this will be just a git repository.</li> <li>The metadata of a subproject is saved in a git-config styled configuration file.</li> <li>Modifications of the subproject are possible and subpatch helps to maintain   a linear patch stack of the modifications.</li> <li>Importing new versions of the subproject is possible and subpatch helps to   rebase the local modifications.</li> </ul>"},{"location":"#subpatch-main-difference","title":"subpatch main difference","text":"<p>When you use subpatch the subprojects are not git repository itself. The files of the subprojects are added as files to the superproject. You will only have to deal with a single git repository.</p> <p>This is in contrast to other tools, e.g.</p> <ul> <li>git-submodules</li> <li>repo</li> <li>kas</li> <li>west</li> </ul> <p>These tools manage multi git repository management and try to combine them into a big superproject.</p>"},{"location":"imprint/","title":"Imprint","text":"<p>This website is created and maintained by</p> <ul> <li>name: Stefan Lengfeld</li> <li>address: Germany, 53721 Siegburg</li> <li>e-mail: stefan+subpatch@lengfeld.xyz</li> </ul> <p>The website's source is available in the folder website/ in the subpatch repository.</p>"},{"location":"exp/comparison/","title":"Comparison to other tools","text":"<p>Subpatch is not the first tool that tries to solve the multi repository problem. Other tools are</p> <ul> <li>git-submodules</li> <li>repo</li> <li>kas</li> <li>west</li> <li>git-subtree</li> </ul> <p>This page will compare these tools with subpatch.</p>"},{"location":"exp/comparison/#technical-comparison","title":"Technical comparison","text":"<p>The following table compares the architecture of the tools</p> subpatch repo git submodule west kas subtree config format git-cfg xml git-cfg ??? yaml none superproject any(1) none git git git git subprojects any(1) git git git git git <p>Explanations of the rows:</p> <ul> <li>config format: The format of the config file that is used to track the   information about the subprojects.</li> <li>superproject: This is the type of cvs that is the top level repository and   also (often) tracks the configuration of subprojects. The repo tool is special here:   It tracks the subprojects in a manifest file in a separate git   repository, the so called manifest repository. But this repository is not   part of the directory hierarchy when the project is checked out. It does not   sit at the top level of the superproject.</li> <li>subprojects: This is the type of cvs that is support as a subproject. For all   other tools, except subpatch, only other git repositories are supported.</li> </ul> <p>Legend:</p> <ul> <li><code>git-cfg</code> stands for the git config format   used in <code>.git/config</code>, <code>~/.gitconfig</code> and <code>.gitmodules</code>.</li> <li><code>(1)</code>: subpatch does not support all other cvs as super- and subprojects for   now. Still work in progress.</li> </ul>"},{"location":"exp/design/","title":"subpatch design","text":"<p>subpatch is based on my experiences and learnings as a (embedded) software engineer. Everything that I have seen and done in the last ten years feeds into the following list of requirements.</p> <p>NOTE: For now the implementation of subpatch not complete. Please read the requirement list as a vision for the first major release of subpatch, not as a status of the implementation.</p>"},{"location":"exp/design/#requirements","title":"Requirements","text":"<p>The tool \u2026</p> <p>(R1) should support git, cvs, mercurial, subversion and non-cvs environment as superprojects.</p> <p>(R2) do not interfere with the vcs. The existing workflows like checking out, cloning, switching branches, updating, rebasing, tagging, forking, bisecting, releasing and ... should stay the same.</p> <p>(R3) should support git, cvs, mercurial, subversion and source code archives (like tarballs or zip files) as source dependencies</p> <p>(R4) should track the original metadata (e.g. url, commit ids, checksums, ... ) of the source dependency to verify the authenticity of the dependency later.</p> <p>(R5) should help integrating updates of the source dependencies.</p> <p>(R6) should support local patching of source dependencies.</p> <p>(R7) If the source dependency is patched locally, it should help maintaining a linear patch stack.</p> <p>(R8) When doing an update of a source dependency and there are no conflicts with the local patches, the tool should rebase local patches automatically.</p> <p>(R9) When doing an update of a source dependency and there are are conflicts with the local patches, the tool should help porting the local patches.</p> <p>(R10) should provided an stable command line API (plumbing commands) to support other tools to track source dependencies, e.g. to automatically check for updates or for CVEs.</p> <p>(R11) Should support every development platform that also supports git and python, like Linux, unixes, Windows and MacOS.</p> <p>(R12) Should scale to the size of the AOSP (Android Open Source Project)</p>"},{"location":"exp/design/#design-decisions","title":"Design Decisions","text":"<p>While developing subpatch, the following design decisions were taken. The requirement list still still gives a lot of freedom for the implementation. Therefore the chosen decisions are documented and explained here.</p> <p>(DD1): written in python3 (but open for a port to another later if successful)</p> <ul> <li>[+] faster iteration speed</li> <li>[+] easier deployment/install of users. python runs everywhere.</li> <li>[+] programming language that I know really good and written a lot of code   already.</li> </ul> <p>(DD2): config file format is <code>git-config</code></p> <ul> <li>[+] the same config format that the main cvs for subpatch (=git) uses.</li> <li>[+] Most developers are already familiar with the config format, e.g. because   they are modyfing <code>~/.git config</code>.</li> </ul> <p>NOTE: This list is not completed yet and should grow while supbatch is developed.</p>"},{"location":"exp/intro/","title":"Introduction","text":"<p>This page should introduce you to the problem space of multi repository management and third party source dependencies. It's not a common problem for every software developers. The problem only arises when dealing for bigger software products, inter team software dependencies and in embedded software engineering.</p> <p>This page explains the issue with two examples:</p> <ul> <li>Example 1: C/C++ library as source dependency</li> <li>Example 2: Embedded Linux firmware based on Yocto</li> </ul>"},{"location":"exp/intro/#example-1-cc-library-as-source-dependency","title":"Example 1: C/C++ library as source dependency","text":"<p>This example illustrates a third party source dependency.</p> <p>I publish a small C/C++ library aminilog. It's useful when writing C/C++ code in a Android Application project that uses the Android NDK (Native Development toolkit). The library provides ready to use logging macros, so a developer does need to write the logging macros for every NDK project from scratch.</p> <p>The library is only publish as a git repository. It's really simple. So there are no releases or tags and no binary artifacts, too. Also binary artifacts would do not make sense, because all of the library content are C/C++ Macros that must be evaluated at compile time of the user of the header.</p> <p>For a talk about the Glass-To-Glass-Latency in Android I made a lot of experiments on the Android platform and develop an Android Application that could perform various tests. I published the code of the application on github in the repo inovex/android-glass-to-glass-latency</p> <p>In this application I also used the Android NDK to write some C++ code to access some libc functions from Java and to trigger the torch light of the Pixel2 phone as fast as possible.</p> <p>And while written and testing the C++ code I needed to write some log messages. Therefore I have imported my aminilog library as a source dependency into the project. The commands were roughly the following:</p> <pre><code>$ mkdir external/\n$ cd external/\n$ git clone https://github.com/lengfeld/aminilog.git\n$ rm -rf aminilog/.git\n$ git add aminilog/\n$ git commit -m \"add aminilog dependency\"\n</code></pre> <p>And then I integrate the library into the cmake build systems by adding the line</p> <pre><code>add_subdirectory(../../../../pixeltorch pixeltorch)\n[...]\ntarget_link_libraries(${PROJECT_NAME} android [...] aminilog)\n</code></pre> <p>into the <code>CMakeLists.txt</code>.</p> <p>In this example the git repository android-glass-to-glass-latency is the superproject and the source dependency aminilog is the subproject.</p>"},{"location":"exp/intro/#example-2-embedded-linux-firmware-based-on-yocto","title":"Example 2: Embedded Linux firmware based on Yocto","text":"<p>TODO add example</p>"},{"location":"exp/intro/#recap","title":"Recap","text":"<p>TODO write recap</p>"},{"location":"ref/glossary/","title":"Glossary","text":"<p>This page is a glossary. More important terms are at the top.</p>"},{"location":"ref/glossary/#superproject","title":"superproject","text":"<p>The superproject is the parent project in a multi repository setup. It's often a git repository itself, e.g. for <code>git submodule</code>. When using subpatch the superproject has the configuration file <code>.subpatch</code> at its top level directory.</p>"},{"location":"ref/glossary/#subprojects","title":"subproject(s)","text":"<p>The subproject or subprojects are the external projects, often called (third party) dependencies, that are added to the superproject.</p> <p>Note: The terms super- and sub-projects are always relative to a specific project setup. It might be the case that the superproject of a project (e.g. a C library with third party dependencies) is the subproject of another project (e.g. a C++ application, using the library).</p>"},{"location":"ref/glossary/#naming-in-different-contexts","title":"Naming in different contexts","text":"<p>The terms superproject/subproject and project/dependency are specific to a given context, but can be used interchangeably. Here is an overview:</p> Context Name for super* Name for sub* package manager project (source) dependencies multi repo problem superproject subprojects multi repo problem super repository sub repositories multi repo problem superrepo subrepos"},{"location":"ref/glossary/#version-control-system-vcs","title":"version control system (vcs)","text":"<p>A version control system is a tool to track changes to a set of files and provides auxiliary functional. Sometimes these are also called source code management tools.</p> <p>Popular version control systems are</p> <ul> <li>git</li> <li>subversion (svn)</li> <li>mercurial</li> <li>Concurrent Versions System (cvs)</li> </ul>"},{"location":"ref/releases/","title":"Releases","text":"<p>This page lists all subpatch release with the release notes. The order is: newest/latest releases are at the top, oldest releases are at the bottom.</p>"},{"location":"ref/releases/#v01a2","title":"v0.1a2","text":"<p>First release of subpatch. For now it supports only two commands: <code>add</code> and <code>status</code> with a very limited amount of functionality.</p> <p>Links:</p> <ul> <li>github release page</li> <li>subpatch   (standalone python script)</li> </ul>"},{"location":"tut/basic-usage/","title":"Basic usage","text":"<p>This tutorial explains how to add a third party dependency with subpatch to a git repository.</p> <p>In this tutorial the superproject is a simple C-library project that contains a function that adds two numbers. The subproject (=third party dependency) is the GoogleTest test library for C and C++ projects.</p>"},{"location":"tut/basic-usage/#prerequisites","title":"Prerequisites","text":"<p>To follow the tutorial you need the following setup</p> <ul> <li>Basic knowledge of git and the command line</li> <li>git installed</li> <li>subpatch installed (See Installation for the details)</li> <li>(optional) cmake and a c/c++ compiler installed</li> </ul>"},{"location":"tut/basic-usage/#cloning-the-example-repository","title":"Cloning the example repository","text":"<p>First you need to clone the example repository. It's the superproject that contains minimal C library . On the command line execute</p> <pre><code>$ git clone https://github.com/lengfeld/subpatch-example0\n$ cd subpatch-example0\n</code></pre> <p>If interested, have a look at the <code>README.md</code> file.</p>"},{"location":"tut/basic-usage/#optional-buliding-the-c-project","title":"(optional) Buliding the C project","text":"<p>If you want, you can also build the C library and test the example program. You need cmake and a c/c++ compiler for that. Execute the commands</p> <pre><code>$ cmake -B build .\n$ cmake --build build\n$ build/prog 9 7\n16\n</code></pre>"},{"location":"tut/basic-usage/#adding-the-third-party-dependency","title":"Adding the third party dependency","text":"<p>The example project contains the file <code>test.cc</code>. It is currently unused, because the GoogleTest dependency is missing. You will add it shortly.</p> <p>As a good practice you should add all third party dependencies in a subfolder called <code>external</code>. To add the dependency execute the commands</p> <pre><code>$ mkdir external\n$ cd external\n$ subpatch add https://github.com/google/googletest\n</code></pre> <p>The last command takes some seconds to execute. It downloads the git repository and extract the files. It uses the default branch of the git repository. In most cases this is the <code>main</code> or the <code>master</code> branch. If you want to download another branch or tag, you must use an additional argument (NOTE: this argument is not implemented yet).</p> <p>When the command finishes it prints the message</p> <pre><code>Adding subproject 'googletest' was successful.\n- To inspect the changes, use `git status` and `git diff --staged`.\n- If you want to keep the changes, commit them with `git commit`.\n- If you want to revert the changes, execute 'git reset --merge`.\n</code></pre> <p>The message contains three different options. To see what subpatch added to the git index, execute</p> <pre><code>$ git status\n</code></pre> <p>There are around 240 new files. Commit them by executing</p> <pre><code>$ cd ..\n$ git commit -m \"external: Adding GooglTest dependency\"\n</code></pre> <p>Info: Apart from the files of the third party dependency subpatch also adds some metadata to the superproject. You can find it a the root directory of the git repository in the file <code>.subpatch</code>. For this tutorial the content looks like</p> <pre><code>[subpatch \"external/googletest\"]\n    url = https://github.com/google/googletest\n</code></pre>"},{"location":"tut/basic-usage/#optional-enable-and-build-the-tests","title":"(optional) Enable and build the tests","text":"<p>After adding the GoogleTest dependency, you can build and execute the tests. Open the <code>CMakeLists.txt</code> file and enable them. You can find the needed cmake configuration already in the file, just remove the comments. Now the last lines of the file should look like</p> <pre><code># Tests\nadd_subdirectory(external/googletest.git gtest)\nadd_executable(test test.cc)\ntarget_link_libraries(test GTest::gtest_main add)\ninclude(GoogleTest)\ngtest_discover_tests(test)\n</code></pre> <p>After that you can build and run the tests with</p> <pre><code>$ cmake --build build\n$ build/test\n</code></pre> <p>Executing the last command will perform all tests and show the test results. All tests should pass!</p>"},{"location":"tut/basic-usage/#congratulations","title":"Congratulations","text":"<p>Congratulations! You have added your first subproject with subpatch.</p>"},{"location":"tut/installation/","title":"Installation","text":"<p>This tutorial explains who to install subpatch on your computer. Currently there are two ways to install subpatch:</p> <ol> <li>With pipx into your HOME directory</li> <li>As a standalone script into the PATH</li> </ol> <p>NOTE: subpatch is currently in a very very early stage. Do not use it in production environments!</p>"},{"location":"tut/installation/#prerequisites","title":"Prerequisites","text":"<p>To follow this tutorial you need a PC or notebook with a Linux Operating System installed. This tutorial will assume Ubuntu, but any current distribution should work. Also MacOS may work out of the box, but it's not tested for now.</p>"},{"location":"tut/installation/#with-pipx-into-your-home-directory","title":"With pipx into your HOME directory","text":"<p>The subpatch project is released on PyPI, the \"Python Package Index\". The PyPI's subpatch site contains the project specific informations.</p>"},{"location":"tut/installation/#install-pipx","title":"Install pipx","text":"<p>To install subpatch, you can use pipx. pipx is a tool to manage python virtual environments in your HOME directory.</p> <p>To install pipx on Ubuntu, execute</p> <pre><code>$ sudo apt install pipx\n</code></pre> <p>NOTE: For other distributions use the distro specific package manager.</p> <p>To check if pipx works, you can execute the <code>list</code> command. An example:</p> <pre><code>$ pipx list\nnothing has been installed with pipx \ud83d\ude34\n</code></pre>"},{"location":"tut/installation/#install-subpatch-with-pipx","title":"Install subpatch with pipx","text":"<p>If everything is fine, you can install the latest version of subpatch with the command</p> <pre><code>$ pipx install subpatch\n</code></pre> <p>The output of the command should look like</p> <pre><code>  installed package subpatch 0.1a2, installed using Python 3.10.12\n  These apps are now globally available\n    - subpatch\ndone! \u2728 \ud83c\udf1f \u2728\n</code></pre> <p>If some of the numbers are different, that's o.k.</p> <p>To test that subpatch works, you can execute the command</p> <pre><code>$ subpatch --version\n</code></pre> <p>It should print the version number of subpatch that is currently installed.</p> <p>Congratulations, now you successfully installed subpatch. A final note: To get further infos and the help text, execute</p> <pre><code>$ subpatch --help\n</code></pre>"},{"location":"tut/installation/#as-a-standalone-script-into-the-path","title":"As a standalone script into the PATH","text":"<p>You can also install subpatch as a standalone python script into your PATH.</p>"},{"location":"tut/installation/#create-a-bin-folder","title":"Create a <code>bin</code> folder","text":"<p>First make sure that you have a directory that is listed in your PATH. If you have another folder in the PATH for other scripts already, you can skip this step.</p> <p>I used a <code>bin</code> directory in the HOME folder for that. To create it, execute</p> <pre><code>$ mkdir ~/bin\n</code></pre> <p>Then this folder must be added to the environment variable PATH. This can be done with</p> <pre><code>$ echo 'export PATH=$PATH:$HOME/bin' &gt;&gt; ~/.bashrc\n</code></pre> <p>It adds a line at the end of the <code>~./bashrc</code> file.</p> <p>The change will only be active in new shells that are spawned now. So start a new shell with</p> <pre><code>$ bash\n</code></pre> <p>NOTE: This tutorial assumes that you are using bash. If you use another shell, like zsh or fish, you mostly already know everything in the tutorial and can adapt it yourself :-)</p> <p>To check that the modifications of the PATH variable worked, execute</p> <pre><code>$ echo $PATH\n</code></pre> <p>It prints all folders that are scanned for executable files. The list should contain the <code>bin</code> folder in your HOME directory at the end.</p>"},{"location":"tut/installation/#download-and-install-subpatch","title":"Download and install subpatch","text":"<p>The last step is to download the subpatch script and copy it into the <code>bin</code> folder.</p> <p>First go to the releases page and find the latest release. There are two options: manual download or using the command line:</p>"},{"location":"tut/installation/#manual-download","title":"Manual download","text":"<p>Now click on the link for standalone python script and download the script with your browser.</p> <p>After you downloaded the standalone script into your download directory, you must move it to the <code>bin</code> directory. For example:</p> <pre><code>$ mv subpatch ~/bin/\n</code></pre> <p>The executable bit is not set for downloaded files. You must manually set it with the command</p> <pre><code>$ chmod +x ~/bin/subpatch\n</code></pre> <p>Otherwise the shell cannot execute the script.</p>"},{"location":"tut/installation/#using-the-command-line","title":"Using the command line","text":"<p>Apart from the manual download, you can use command line tools. To download the script and set the executable bit, just execute:</p> <pre><code>$ wget https://github.com/lengfeld/subpatch/releases/download/v0.1a2/subpatch -O ~/bin/subpatch\n$ chmod +x ~/bin/subpatch\n</code></pre> <p>The above command is just an example. For other versions of subpatch, the version number in the URL looks different.</p>"},{"location":"tut/installation/#test-subpatch","title":"Test subpatch","text":"<p>After download and installation you should test the subpatch command line tool. To test that it works, you can execute the command</p> <pre><code>$ subpatch --version\n</code></pre> <p>It should print the version number of subpatch that is currently installed.</p> <p>Congratulations, now you successfully installed subpatch. A final note: To get further infos and the help text, execute</p> <pre><code>$ subpatch --help\n</code></pre>"}]}